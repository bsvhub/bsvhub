<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<title>₿SVhub.app</title>
    <!-- MAIN STYLES -->
    <!-- ============================================================
     BASE DESKTOP STYLES (ALWAYS LOADED)
	============================================================ -->
	<link rel="stylesheet" href="styles/main.css">

	<!-- ============================================================
		 MOBILE OVERRIDES (DYNAMICALLY ENABLED)
		 - Empty by default
		 - JS will set href to styles/mobile.css when needed
	============================================================ -->
	<link id="mobile-css" rel="stylesheet" href="">

	<!-- ============================================================
		 BACKGROUND / EFFECT STYLES
	============================================================ -->
	<link rel="stylesheet" href="styles/firefly.css">

</head>

<body>
<div id="page-wrapper">
<!-- ============================================================
     LAYER 0 — BACKGROUND LAYERS
============================================================ -->

<div id="background-layer" class="background-layer"></div>
<div id="firefly-layer" class="firefly-layer"></div>

<audio id="copy-sfx" src="styles/assets/copy.mp3"></audio>

<script>
const fireflyLayer = document.getElementById("firefly-layer");
const PARTICLE_COUNT = 33; // Number of particles

for (let i = 0; i < PARTICLE_COUNT; i++) {
    const f = document.createElement("div");
    f.classList.add("firefly");

    // Random horizontal position (0% - 100%)
    f.style.setProperty('--x', Math.random() * 100);

    // Random rise duration (8s - 18s)
    f.style.setProperty('--duration', 8 + Math.random() * 10 + 's');

    // Random fade duration (2s - 5s)
    f.style.setProperty('--fade-duration', 2 + Math.random() * 3 + 's');

    // Random animation delay (0s - 10s)
    f.style.setProperty('--delay', Math.random() * 10 + 's');

    // Random particle size (3px - 7px)
    f.style.setProperty('--firefly-size', 3 + Math.random() * 4 + 'px');

    fireflyLayer.appendChild(f);
}
</script>


<!-- ============================================================
     LAYER 1 — TOP UI (HEADER + TAB BAR + TOOLTIP)
============================================================ -->

<div id="top-ui">

    <!-- HEADER -->
    <header class="header-container">
        <div class="header-icons header-icons-left">
            <a href="#" data-target="about-section" class="header-text-link">About</a>
            <a href="#" data-target="tip-section" class="header-text-link">Tip</a>
        </div>

        <h1 class="header-title">₿SVhub.app</h1>

        <div class="header-icons header-icons-right">
            <a href="#" id="mobile-toggle" class="header-text-link">mobile</a>
            <a href="#" data-target="contact-section" class="header-text-link">Contact</a>
        </div>
    </header>


    <!-- TAB BAR -->
    <nav class="tab-bar">

        <button class="tab-btn" data-target="tools">Tools</button>
        <button class="tab-btn" data-target="apps">Apps</button>
        <button class="tab-btn" data-target="wallets">Wallets</button>
        <button class="tab-btn" data-target="exchange">Buy BSV</button>
        <button class="tab-btn" data-target="bsv">BSV Main Sites</button>
        <button class="tab-btn" data-target="docs">Documents</button>
        <!--button class="tab-btn" data-target="mining">Mining</button-->
        <button class="tab-btn" data-target="new">New</button>
        <button class="tab-btn" data-target="social">Social</button>
        <button class="tab-btn" data-target="videos">Videos</button>

        <div class="search-container">
            <input id="search-box" type="text" placeholder="search here">
        </div>

    </nav>

    <!-- TOOLTIP BAR -->
    <div id="tooltip-display"></div>

</div>



<!-- ============================================================
     LAYER 2 — CONTENT AREA (SCROLLABLE)
============================================================ -->

<main id="content-area">

    <!-- SEARCH RESULTS -->
    <section id="search-results" class="tab-content"></section>

    <!-- STATIC ABOUT SECTION -->
    <section id="about-section" class="tab-content header-tab-content">
		<div class="header-tab-text">
			Number of visitors: 
			<span id="visit-counter" style="pointer-events:none;">
				<script src="https://counter.websiteout.com/js/7/6/0/0"></script>
			</span>
		</div>

		<div>Last update: <span id="last-update-date"></span></div>
	</section>



</main>

<script>
function loadLastUpdate() {
  fetch("list.json")
    .then(r => r.json())
    .then(data => {
      const date = data.sections?.["info-section"]?.lastUpdate;
      const el = document.getElementById("last-update-date");
      if (date && el) el.textContent = date;
    })
    .catch(err => console.error("Failed to load update date:", err));
}

loadLastUpdate();
</script>

<!-- ============================================================
     1 — TOOLTIP SYSTEM (scrolling default message + icon tooltips + 2s delay)
============================================================ -->
<script>
const tooltipBox = document.getElementById("tooltip-display");
let defaultTooltipMessage = "Loading...";
let revertTimeout = null; // store the 2s timeout

// Fetch default scroll message from text file
fetch("tooltip-message.txt")
  .then(response => response.text())
  .then(text => {
      defaultTooltipMessage = text.trim();
      showDefaultTooltip();
  })
  .catch(() => showDefaultTooltip());

// Display scrolling default message with repeated text
function showDefaultTooltip() {
    const repeated = Array(50).fill(defaultTooltipMessage).join("\u00A0\u00A0\u00A0•\u00A0\u00A0\u00A0"); // more spaces
    tooltipBox.innerHTML = `<span>${repeated}</span>`;
    tooltipBox.classList.add("marquee");
}

// Update tooltip expansion class
function updateTooltipWrapAnimation() {
    tooltipBox.classList.toggle("expanded", tooltipBox.scrollHeight > 28);
}

// Set tooltip text for icon hovers or revert to default scroll message
function setTooltipText(text) {
    // Clear any existing revert timeout
    if (revertTimeout) {
        clearTimeout(revertTimeout);
        revertTimeout = null;
    }

    if (text) {
        // Show icon tooltip immediately
        tooltipBox.innerHTML = text;
        tooltipBox.classList.remove("marquee");
        updateTooltipWrapAnimation();
    } else {
        // Delay 2s before restoring scrolling message
        revertTimeout = setTimeout(() => {
			const repeated = Array(50).fill(defaultTooltipMessage).join("\u00A0\u00A0\u00A0•\u00A0\u00A0\u00A0");
			tooltipBox.innerHTML = `<span>${repeated}</span>`;
			tooltipBox.classList.add("marquee");
			updateTooltipWrapAnimation();
			revertTimeout = null;
		}, 2000);

    }

    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            if (typeof positionContent === 'function') positionContent(null);
        });
    });
}


// Bind tooltips to icons
function bindTooltips() {
    document.querySelectorAll(".icon-wrapper[data-tooltip]").forEach(wrapper => {
        const text = wrapper.dataset.tooltip;

        wrapper.addEventListener("mouseenter", () => {
            setTooltipText(text);
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    if (typeof positionContent === "function") positionContent(wrapper);
                });
            });
        });

        wrapper.addEventListener("mouseleave", () => {
            setTooltipText(""); // will revert to scrolling default after 2s
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    if (typeof positionContent === "function") positionContent(null);
                });
            });
        });
    });
}
</script>



<!-- ============================================================
     JS SECTION 2 — BACKGROUND GRADIENT
============================================================ -->

<script>
const colors = ["#555555", "#6a0dad", "#001f54"];
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
document.getElementById("background-layer").style.background =
  `linear-gradient(135deg, ${shuffle([...colors]).join(', ')})`;
</script>


<!--=========================================================
     JS SECTION 3 — TAB SYSTEM  (WITH SEARCH RESET ADDED)
============================================================ -->
<script>
const tabButtons = document.querySelectorAll('.tab-btn');
const headerLinks = document.querySelectorAll('.header-text-link:not(#mobile-toggle)');


/* ------------------------------------------------------------
   RESET SEARCH
   - clears input
   - hides search results section
   - resets layout
------------------------------------------------------------ */
function resetSearch() {
    const resultSec = document.getElementById("search-results");
    const searchBox = document.getElementById("search-box");

    searchBox.value = "";                 // clear input
    resultSec.innerHTML = "";             // clear search results
    resultSec.classList.remove("active"); // hide search results

    // DEACTIVATE ALL TAB CONTENTS
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    requestAnimationFrame(() => {
        if (typeof positionContent === "function") {
            positionContent(null);        // fix layout
        }
    });
}


/* ------------------------------------------------------------
   ACTIVATE TAB
------------------------------------------------------------ */
function activateTab(targetId, source) {
    tabButtons.forEach(b => b.classList.remove('active'));
    headerLinks.forEach(h => h.classList.remove('active'));

    if (source) source.classList.add('active');

    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    const sec = document.getElementById(targetId);
    if (sec) sec.classList.add('active');
}

/* ------------------------------------------------------------
   TAB BUTTON CLICK — WITH SEARCH RESET
------------------------------------------------------------ */
tabButtons.forEach(btn =>
    btn.addEventListener("click", () => {
        resetSearch();  // <-- NEW
        activateTab(btn.dataset.target, btn);
    })
);

/* ------------------------------------------------------------
   HEADER LINK CLICK — WITH SEARCH RESET
------------------------------------------------------------ */
headerLinks.forEach(link =>
    link.addEventListener("click", (e) => {
        e.preventDefault();
        resetSearch();  // <-- NEW
        activateTab(link.dataset.target, link);
    })
);

</script>



<script>
/* ============================================================
   4 — BASELINE CONTENT POSITIONING (NO HOVER SHIFTING)
   Keeps content-area placed directly below #top-ui.
   ============================================================ */

(function () {
    const content = document.getElementById("content-area");
    const topUI = document.getElementById("top-ui");

    // Reposition content-area directly under top UI (header + tabs + tooltip)
    function positionContent() {
        const baseTop = topUI.offsetHeight;
        content.style.top = `${baseTop}px`;
    }

    // Expose globally
    window.positionContent = positionContent;

    // Re-run on resize
    window.addEventListener("resize", positionContent);

    // Run once at load
    requestAnimationFrame(positionContent);
})();
</script>


<!-- ============================================================
     JS SECTION 5 — ICON TEXT AUTO-FIT
============================================================ -->

<!--script>
function adjustIconTextSmart() {
    document.querySelectorAll('.icon-wrapper').forEach(icon => {
        const t = icon.querySelector('.icon-text');
        t.style.whiteSpace = "nowrap";
        if (t.scrollWidth > icon.offsetWidth) {
            t.style.whiteSpace = "normal";
            t.style.maxWidth = "90%";
        }
    });
}
</script>



<!-- ============================================================
     JS SECTION 6 — JSON LOADER (FIXED & ROBUST)
     - builds sections
     - binds behaviors
     - positions content (double RAF)
     - auto-activates "new" tab or first tab fallback
============================================================ -->
<script>
fetch("list.json")
  .then(r => r.json())
  .then(data => {
    const container = document.getElementById("content-area");

    // Build sections
    Object.entries(data.sections).forEach(([id, section]) => {
      const sec = document.createElement("section");
      sec.id = id;
      sec.className = "tab-content";

      if (section.items) {
        const ul = document.createElement("ul");
        ul.className = "icon-grid";

        section.items.forEach(item => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = item.href || "#";
          a.target = "_blank";

          const wrap = document.createElement("div");
          wrap.className = "icon-wrapper";
          if (item.tooltip) wrap.dataset.tooltip = item.tooltip;

          const img = document.createElement("img");
          img.src = item.img || "";
          img.alt = item.alt || "";

          const txt = document.createElement("div");
          txt.className = "icon-text";
          txt.textContent = item.text || "";

          wrap.appendChild(img);
          wrap.appendChild(txt);
          a.appendChild(wrap);
          li.appendChild(a);
          ul.appendChild(li);
        });

        sec.appendChild(ul);
      }

      if (section.html) sec.innerHTML = section.html;

      container.appendChild(sec);
    });

    // Bind behaviors
    bindTooltips();
    // adjustIconTextSmart(); // optional

    // Ensure tab buttons exist
    const tabButtons = document.querySelectorAll('.tab-btn');

    // Activate "new" tab or first tab
    const newBtn = document.querySelector('.tab-btn[data-target="new"]');
    const firstBtn = tabButtons[0];
    const targetBtn = newBtn || firstBtn;

    if (targetBtn) {
      // Use requestAnimationFrame to wait until DOM fully painted
      requestAnimationFrame(() => {
        activateTab(targetBtn.dataset.target, targetBtn);
      });
    }
  })
  .catch(err => console.error(err));

</script>

<!-- ============================================================
     JS SECTION 7 — SEARCH SYSTEM (SLIMMED & WORKING)
============================================================ -->
<script>
const searchBox = document.getElementById("search-box");
const resultSec = document.getElementById("search-results");
const excludedTabs = ["about-section", "tip-section", "info-section", "contact-section"];

searchBox.addEventListener("input", () => {
    const q = searchBox.value.toLowerCase();

    // Clear previous search results
    resultSec.innerHTML = "";

    // If search is empty, hide results and restore nothing
    if (!q) {
        resultSec.classList.remove("active");
        return;
    }

    // DEACTIVATE CURRENT TAB AND TAB BUTTONS
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );
    document.querySelectorAll('.tab-btn').forEach(btn =>
        btn.classList.remove('active')
    );

    const grid = document.createElement("ul");
    grid.className = "icon-grid";
    const found = new Set();

    // The excludedTabs array prevents searching these sections
    document.querySelectorAll('.tab-content').forEach(sec => {
        if (excludedTabs.includes(sec.id)) return;  // Skip excluded sections

        sec.querySelectorAll('.icon-wrapper').forEach(icon => {

			// ------------------------------------------------------------
			// 1. ICON VISIBLE TEXT
			//    This is the label shown under each icon
			// ------------------------------------------------------------
			const txt =
				icon.querySelector('.icon-text')?.textContent.toLowerCase() || "";

			// ------------------------------------------------------------
			// 2. TOOLTIP TEXT
			//    Pulled from data-tooltip attribute (if present)
			// ------------------------------------------------------------
			const tip =
				(icon.dataset.tooltip || "").toLowerCase();

			// ------------------------------------------------------------
			// 3. LINK URL (href)
			//    Allows searching by domain or partial URL
			// ------------------------------------------------------------
			const link = icon.closest('a');
			const href =
				link ? (link.getAttribute('href') || "").toLowerCase() : "";

			// ------------------------------------------------------------
			// 4. IMAGE ALT TEXT  ← NEW
			//    Uses <img alt=""> from your list.json
			// ------------------------------------------------------------
			const img = icon.querySelector('img');
			const alt =
				img ? (img.getAttribute('alt') || "").toLowerCase() : "";

			// ------------------------------------------------------------
			// 5. MATCH LOGIC
			//    Matches if query appears in ANY searchable field
			// ------------------------------------------------------------
			if (
				(txt.includes(q) ||
				 tip.includes(q) ||
				 href.includes(q) ||
				 alt.includes(q)) &&

				// Prevent duplicate entries in search results
				!found.has(txt)
			) {
				// Clone the original <li> so layout + links remain intact
				grid.appendChild(icon.closest("li").cloneNode(true));

				// Track this item as already added
				found.add(txt);
			}
		});

    });

    // If any matches are found, display the results
    if (found.size > 0) {
        resultSec.appendChild(grid);
        bindTooltips();
        resultSec.classList.add("active");
    } else {
        resultSec.classList.remove("active");
    }
});
</script>


<!-- ============================================================
     JS SECTION 9 — COPY BUTTON SOUND
============================================================ -->

<script>
document.addEventListener("click", (e) => {
    if (e.target.id === "copy-tip-btn") {
        document.getElementById("copy-sfx").play();
    }
});
</script>

<!-- ============================================================
   JS SECTION 10 — MOBILE / DESKTOP MODE TOGGLE (STATE-PRESERVING + FADE TRANSITION)
   ------------------------------------------------------------
   - Switches CSS only
   - Preserves active tab + content
   - Adds lightweight fade transition
   - Minimal GPU usage, snappy
============================================================ -->
<script>

/* ------------------------------------------------------------
   DOM REFERENCES
------------------------------------------------------------ */
const mobileToggle = document.getElementById("mobile-toggle");
const mobileCSS = document.getElementById("mobile-css");
const wrapper = document.getElementById("page-wrapper"); // wrap everything in HTML

/* ------------------------------------------------------------
   CAPTURE CURRENT UI STATE
   - Active tab button (if any)
   - Active header link (if any)
   - Active content section
------------------------------------------------------------ */
function captureUIState() {
    return {
        activeTabBtn: document.querySelector(".tab-btn.active"),
        activeHeaderLink: document.querySelector(".header-text-link.active"),
        activeSection: document.querySelector(".tab-content.active")
    };
}

/* ------------------------------------------------------------
   RESTORE UI STATE
   - Reapply .active classes without triggering tab logic
------------------------------------------------------------ */
function restoreUIState(state) {
    document.querySelectorAll(".tab-btn, .header-text-link")
        .forEach(el => el.classList.remove("active"));

    document.querySelectorAll(".tab-content")
        .forEach(sec => sec.classList.remove("active"));

    if (state.activeTabBtn) state.activeTabBtn.classList.add("active");
    if (state.activeHeaderLink) state.activeHeaderLink.classList.add("active");
    if (state.activeSection) state.activeSection.classList.add("active");
}

/* ------------------------------------------------------------
   ENABLE / DISABLE MOBILE MODE
   - Only switches CSS and updates toggle text
   - Does NOT trigger tab logic
------------------------------------------------------------ */
function enableMobileMode(state) {
    mobileCSS.href = "styles/mobile.css";
    mobileToggle.textContent = "desktop";
    localStorage.setItem("ui-mode", "mobile");

    requestAnimationFrame(() => {
        restoreUIState(state);
        if (typeof positionContent === "function") positionContent();
    });
}

function disableMobileMode(state) {
    mobileCSS.href = "";
    mobileToggle.textContent = "mobile";
    localStorage.setItem("ui-mode", "desktop");

    requestAnimationFrame(() => {
        restoreUIState(state);
        if (typeof positionContent === "function") positionContent();
    });
}

/* ------------------------------------------------------------
   LIGHTWEIGHT FADE TRANSITION FOR CSS SWITCH
   - fade out wrapper → swap CSS → fade back in
------------------------------------------------------------ */
function swapModeWithFade(enableMobile) {
    wrapper.classList.add("fading"); // fade out

    // Swap CSS almost immediately (tiny overlap with fade)
    setTimeout(() => {
        const state = captureUIState();
        if (enableMobile) enableMobileMode(state);
        else disableMobileMode(state);
    }, 50); // 50ms allows fade start

    // Fade back in after total duration
    setTimeout(() => {
        wrapper.classList.remove("fading");
    }, 200); // match CSS transition duration
}

/* ------------------------------------------------------------
   MOBILE TOGGLE CLICK HANDLER
   - Blink feedback
   - State capture
   - Fade + CSS swap
------------------------------------------------------------ */
mobileToggle.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation(); // prevent tab logic

    // Visual feedback blink
    mobileToggle.classList.add("blink");
    setTimeout(() => mobileToggle.classList.remove("blink"), 150);

    // Ensure toggle never stays active
    mobileToggle.classList.remove("active");

    // Determine mode to switch to
    const enableMobile = localStorage.getItem("ui-mode") !== "mobile";

    // Perform fade + mode swap
    swapModeWithFade(enableMobile);
});

/* ------------------------------------------------------------
   RESTORE MODE ON PAGE LOAD
   - safe, after all tabs + content have initialized
------------------------------------------------------------ */
window.addEventListener("load", () => {
    if (localStorage.getItem("ui-mode") === "mobile") {
        const state = captureUIState();
        enableMobileMode(state);
    }
});

</script>

</div>
</body>
</html>
