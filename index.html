<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<title>₿SVhub.io</title>
    <!-- MAIN STYLES -->
    <!-- ============================================================
     BASE DESKTOP STYLES (ALWAYS LOADED)
	============================================================ -->
	<link rel="stylesheet" href="styles/main.css">

	<!-- ============================================================
		 MOBILE OVERRIDES (DYNAMICALLY ENABLED)
		 - Empty by default
		 - JS will set href to styles/mobile.css when needed
	============================================================ -->
	<link id="mobile-css" rel="stylesheet" href="">

	<!-- ============================================================
		 BACKGROUND / EFFECT STYLES
	============================================================ -->
	<link rel="stylesheet" href="styles/firefly.css">

</head>

<body>
<div id="page-wrapper">
<!-- ============================================================
     LAYER 0 — BACKGROUND LAYERS
============================================================ -->

<div id="background-layer" class="background-layer"></div>
<div id="firefly-layer" class="firefly-layer"></div>

<audio id="copy-sfx" src="styles/assets/copy.mp3"></audio>


<!-- ============================================================
     LAYER 1 — TOP UI (HEADER + TAB BAR + TOOLTIP)
============================================================ -->

<div id="top-ui">

    <!-- HEADER -->
    <header class="header-container">
        <div class="header-icons header-icons-left">
            <a href="#" data-target="about-section" class="header-text-link">About</a>
            <a href="#" data-target="tip-section" class="header-text-link">Tip</a>
        </div>

        <h1 class="header-title">₿SVhub.io</h1>

        <div class="header-icons header-icons-right">
			<a href="#" data-target="contact-section" class="header-text-link">Contact</a>
            <a href="#" id="mobile-toggle" class="header-text-link">mobile</a>
            
        </div>
    </header>


    <!-- TAB BAR -->
    <nav class="tab-bar">

        <button class="tab-btn" data-target="tools"><span>Tools</span></button>
        <button class="tab-btn" data-target="apps"><span>Apps</span></button>
        <button class="tab-btn" data-target="wallets"><span>Wallets</span></button>
        <button class="tab-btn" data-target="exchange"><span>Buy BSV</span></button>
        <button class="tab-btn" data-target="bsv"><span>BSV Main Sites</span></button>
        <button class="tab-btn" data-target="docs"><span>Documents</span></button>
        <button class="tab-btn" data-target="social"><span>Social Media</span></button>
        <button class="tab-btn" data-target="videos"><span>Videos</span></button>
        <!--button class="tab-btn" data-target="tools">Tools</!--button>
        <button class="tab-btn" data-target="apps">Apps</button>
        <button class="tab-btn" data-target="wallets">Wallets</button>
        <button class="tab-btn" data-target="exchange">Buy BSV</button>
        <button class="tab-btn" data-target="bsv">BSV Main Sites</button>
        <button class="tab-btn" data-target="docs">Documents</button>
        <button class="tab-btn" data-target="social">Social Media</button>
        <button class="tab-btn" data-target="videos">Videos</button-->

        <div class="search-container">
            <input id="search-box" type="text" placeholder="search here">
        </div>

    </nav>

    <!-- TOOLTIP BAR -->
    <div id="tooltip-display"></div>

</div>



<!-- ============================================================
     LAYER 2 — CONTENT AREA (SCROLLABLE)
============================================================ -->

<main id="content-area">

    <!-- SEARCH RESULTS -->
    <section id="search-results" class="tab-content"></section>

    
</main>
 
    
<!-- ============================================================
     JS SECTION 1 — TOOLTIPS + MOBILE DOUBLE-TAP (EVENT DELEGATION)
     ------------------------------------------------------------
     Desktop: Hover tooltips, single-click links
     Mobile: First tap = tooltip, second tap = navigate
     Uses event delegation - works on all icons automatically
============================================================ -->
<script>
/* ============================================================
   TOOLTIP STATE
============================================================ */
const tooltipBox = document.getElementById("tooltip-display");
let defaultTooltipMessage = "Loading...";
let revertTimeout = null;
let lastTappedLink = null;

/* ============================================================
   MOBILE MODE DETECTION
============================================================ */
function isMobileMode() {
    const css = document.getElementById("mobile-css");
    return !!(css && css.href && css.href.includes("mobile.css"));
}

/* ============================================================
   DEFAULT TOOLTIP (MARQUEE) - DYNAMIC SPEED BASED ON LENGTH
============================================================ */
fetch("tooltip-message.txt")
    .then(r => r.text())
    .then(t => {
        defaultTooltipMessage = t.trim();
        showDefaultTooltip();
    })
    .catch(showDefaultTooltip);

function showDefaultTooltip() {
    const separator = "\u00A0\u00A0\u00A0•\u00A0\u00A0\u00A0";
    const repeated = Array(5).fill(defaultTooltipMessage).join(separator);
    tooltipBox.innerHTML = `<span>${repeated}</span>`;
    tooltipBox.classList.add("marquee");
    tooltipBox.classList.remove("expanded");
    
    // Calculate animation duration based on text length
    const span = tooltipBox.querySelector('span');
    if (span) {
        const textLength = defaultTooltipMessage.length;
        
        // Base speed: ~60 pixels per second (adjust multiplier to taste)
        // Longer text = proportionally longer duration for consistent speed
        const duration = Math.max(10, textLength * 0.15); // min 10s, scales with length
        
        span.style.animationDuration = `${duration}s`;
    }
}

/* ============================================================
   SET TOOLTIP TEXT
============================================================ */
function setTooltipText(text) {
    if (revertTimeout) clearTimeout(revertTimeout);

    if (text) {
        tooltipBox.innerHTML = text;
        tooltipBox.classList.remove("marquee");
        tooltipBox.classList.add("expanded");
    } else {
        revertTimeout = setTimeout(showDefaultTooltip, 2000);
    }

    // Re-measure layout after tooltip change
    requestAnimationFrame(() => {
        if (typeof positionContent === "function") positionContent();
    });
}

/* ============================================================
   DESKTOP HOVER TOOLTIPS (EVENT DELEGATION)
============================================================ */
document.addEventListener("mouseenter", (e) => {
    if (isMobileMode()) return;
    const wrap = e.target.closest(".icon-wrapper[data-tooltip]");
    if (wrap) setTooltipText(wrap.dataset.tooltip);
}, true);

document.addEventListener("mouseleave", (e) => {
    if (isMobileMode()) return;
    const wrap = e.target.closest(".icon-wrapper[data-tooltip]");
    if (wrap) setTooltipText("");
}, true);

/* ============================================================
   MOBILE DOUBLE-TAP (EVENT DELEGATION)
============================================================ */
document.addEventListener("click", (e) => {
    if (!isMobileMode()) return;
    
    const wrap = e.target.closest(".icon-wrapper");
    if (!wrap) return;
    
    const link = wrap.closest("a");
    if (!link) return;

    // Clear previous selection if different icon
    if (lastTappedLink && lastTappedLink !== link) {
        lastTappedLink.classList.remove("mobile-selected");
    }

    // First tap - show tooltip
    if (!link.classList.contains("mobile-selected")) {
        e.preventDefault();
        link.classList.add("mobile-selected");
        lastTappedLink = link;
        setTooltipText(wrap.dataset.tooltip || wrap.textContent || "Tap again to open");
        return;
    }

    // Second tap - navigate (allow default)
    link.classList.remove("mobile-selected");
    lastTappedLink = null;
}, true);

/* ============================================================
   CLEAR SELECTION HELPER
============================================================ */
function clearDoubleTapSelection() {
    if (lastTappedLink) {
        lastTappedLink.classList.remove("mobile-selected");
        lastTappedLink = null;
        setTooltipText("");
    }
}

/* ============================================================
   AUTO-CLEAR TRIGGERS
============================================================ */
document.addEventListener('pointerdown', (e) => {
    if (!isMobileMode()) return;
    const isIconArea = e.target.closest('.icon-wrapper');
    if (!isIconArea) clearDoubleTapSelection();
}, { capture: true });

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') clearDoubleTapSelection();
});

window.addEventListener('blur', clearDoubleTapSelection);

document.addEventListener('visibilitychange', () => {
    if (document.hidden) clearDoubleTapSelection();
});

/* ============================================================
   TOOLTIP HEIGHT TRANSITION HANDLER
============================================================ */
tooltipBox.addEventListener("transitionend", (e) => {
    if (e.propertyName === "max-height" || e.propertyName === "padding") {
        if (typeof positionContent === "function") positionContent();
    }
});
</script>  
    
<!-- ============================================================
     JS SECTION 2 — BACKGROUND GRADIENT
============================================================ -->

<script>
const colors = ["#555555", "#6a0dad", "#001f54"];
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
document.getElementById("background-layer").style.background =
  `linear-gradient(135deg, ${shuffle([...colors]).join(', ')})`;
</script>


<!--=========================================================
     JS SECTION 3 — TAB SYSTEM  (WITH SEARCH RESET ADDED)
============================================================ -->
<script>
const tabButtons = document.querySelectorAll('.tab-btn');
const headerLinks = document.querySelectorAll('.header-text-link:not(#mobile-toggle)');


/* ------------------------------------------------------------
   RESET SEARCH
   - clears input
   - hides search results section
   - resets layout
------------------------------------------------------------ */
function resetSearch() {
    const resultSec = document.getElementById("search-results");
    const searchBox = document.getElementById("search-box");

    searchBox.value = "";                 // clear input
    resultSec.innerHTML = "";             // clear search results
    resultSec.classList.remove("active"); // hide search results

    // DEACTIVATE ALL TAB CONTENTS
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    requestAnimationFrame(() => {
        if (typeof positionContent === "function") {
            positionContent(null);        // fix layout
        }
    });
}


/* ------------------------------------------------------------
   ACTIVATE TAB
------------------------------------------------------------ */
function activateTab(targetId, source) {
    tabButtons.forEach(b => b.classList.remove('active'));
    headerLinks.forEach(h => h.classList.remove('active'));

    if (source) source.classList.add('active');

    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    const sec = document.getElementById(targetId);
    if (sec) sec.classList.add('active');
    
    // Desktop: scroll window
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Mobile: scroll content-area directly (handles scaled content)
    const contentArea = document.getElementById('content-area');
    if (contentArea) {
        contentArea.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

/* ------------------------------------------------------------
   TAB BUTTON CLICK — WITH SEARCH RESET
------------------------------------------------------------ */
tabButtons.forEach(btn =>
    btn.addEventListener("click", () => {
        clearDoubleTapSelection(); // <-- NEW: release any armed icon
        resetSearch();  // <-- NEW
        activateTab(btn.dataset.target, btn);
    })
);

/* ------------------------------------------------------------
   HEADER LINK CLICK — WITH SEARCH RESET
------------------------------------------------------------ */
headerLinks.forEach(link =>
    link.addEventListener("click", (e) => {
        e.preventDefault();
        clearDoubleTapSelection(); // <-- NEW: release any armed icon
        resetSearch();  // <-- NEW
        activateTab(link.dataset.target, link);
    })
);

</script>



<script>
/* ============================================================
   4 — BASELINE CONTENT POSITIONING (NO HOVER SHIFTING)
   Keeps content-area placed directly below #top-ui.
   ============================================================ */


// index.html — reuse your existing positionContent function to also set a CSS var
(function () {
  const content = document.getElementById("content-area");
  const topUI = document.getElementById("top-ui");
  function positionContent() {
    const baseTop = topUI.offsetHeight;
    content.style.top = `${baseTop}px`;
    document.documentElement.style.setProperty('--top-ui-height', `${baseTop}px`);
  }
  window.positionContent = positionContent;
  window.addEventListener("resize", positionContent);
  requestAnimationFrame(positionContent);
})();

</script>

<!-- ============================================================
     JS SECTION 5 — JSON LOADER (NEW STRUCTURE)
     - builds header sections
     - filters items by tab
     - sorts alphabetically by "text"
     - creates 4-position badge system
     - applies zoom per icon
============================================================ -->
<script>
fetch("list.json")
  .then(r => r.json())
  .then(data => {
    const container = document.getElementById("content-area");

    // ========================================
    // 1. BUILD HEADER SECTIONS (About, Tip, Contact)
    // ========================================

    if (data.headerContent) {
      Object.entries(data.headerContent).forEach(([id, section]) => {
        const sec = document.createElement("section");
        sec.id = id + "-section";
        sec.className = section.class || "tab-content header-tab-content";

        if (section.html) {
          sec.innerHTML = section.html;
        }

        container.appendChild(sec);
      });
    }
    
    
    // ========================================
    // 2. GET ALL UNIQUE TAB NAMES FROM ITEMS
    // ========================================
    const tabNames = new Set();
    data.items.forEach(item => {
      const tabs = item.tab.split(";");
      tabs.forEach(t => tabNames.add(t.trim()));
    });

    // ========================================
    // 3. BUILD EACH TAB SECTION
    // ========================================
    tabNames.forEach(tabName => {
      const sec = document.createElement("section");
      sec.id = tabName;
      sec.className = "tab-content";

      const ul = document.createElement("ul");
      ul.className = "icon-grid";

      // FILTER items that belong to this tab
      const tabItems = data.items.filter(item => {
        const tabs = item.tab.split(";").map(t => t.trim());
        return tabs.includes(tabName);
      });

      // SORT alphabetically by "text" field
      tabItems.sort((a, b) => {
        const textA = (a.text || "").toLowerCase();
        const textB = (b.text || "").toLowerCase();
        return textA.localeCompare(textB);
      });

      // BUILD each icon
      tabItems.forEach(item => {
        const li = document.createElement("li");

        const a = document.createElement("a");
        a.href = item.href || "#";
        a.target = "_blank";

        const wrap = document.createElement("div");
        wrap.className = "icon-wrapper";
        if (item.tooltip) wrap.dataset.tooltip = item.tooltip;

        // SET ZOOM (as CSS variable)
        if (item.zoom) {
          wrap.style.setProperty("--icon-zoom", item.zoom);
        }

        // Base icon image
        const img = document.createElement("img");
        img.src = item.img || "";
        img.alt = item.alt || "";
        wrap.appendChild(img);

        // ========================================
        // 4-POSITION BADGE SYSTEM
        // ========================================
        if (item.info) {
          const badges = item.info.split(";"); // e.g., "new.png;;verified.png;"
          
          badges.forEach((badgeFile, index) => {
            if (badgeFile.trim()) {  // only if not empty
              const badge = document.createElement("img");
              badge.src = "icon/" + badgeFile.trim();
              badge.alt = "";
              badge.className = `icon-badge-pos${index + 1}`; // pos1, pos2, pos3, pos4
              wrap.appendChild(badge);
            }
          });
        }

        // Icon label under the image
        const txt = document.createElement("div");
        txt.className = "icon-text";
        txt.textContent = item.text || "";
        wrap.appendChild(txt);

        // Assemble
        a.appendChild(wrap);
        li.appendChild(a);
        ul.appendChild(li);
      });

      sec.appendChild(ul);
      container.appendChild(sec);
    });

    
    // ========================================
    // 5. ACTIVATE FIRST TAB
    // ========================================
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        const firstBtn = document.querySelector('.tab-btn');
        if (firstBtn) {
          activateTab(firstBtn.dataset.target, firstBtn);
        }
        if (typeof positionContent === "function") positionContent();
      });
    });

  })
  .catch(err => console.error(err));
</script>

<!-- ============================================================
     VISITOR COUNTER SCRIPT
============================================================ -->
<script>
(function() {
    function loadCounter() {
        const counterSpan = document.getElementById('visit-counter');
        if (counterSpan) {
            const iframe = document.createElement('iframe');
            iframe.style.border = 'none';
            iframe.style.width = '100%';
            iframe.style.height = '30px';
            iframe.style.verticalAlign = 'middle';
            iframe.style.display = 'block';
            iframe.style.marginTop = '10px';  // Add space above counter
            counterSpan.appendChild(iframe);
            
            const iframeDoc = iframe.contentWindow.document;
            iframeDoc.open();
            iframeDoc.write('<html><body style="margin:0;padding:0;font-family:VT323,monospace;font-size:2rem;color:#ffd700;text-align:center;"><script src="https://counter.websiteout.com/js/7/6/0/0"><\/script></body></html>');
            iframeDoc.close();
        } else {
            setTimeout(loadCounter, 100);
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadCounter);
    } else {
        loadCounter();
    }
})();
</script>
    
<!-- ============================================================
     JS SECTION 6 — SEARCH SYSTEM (NEW STRUCTURE - ENHANCED)
     - Searches: tab, href, tooltip, alt, text, info
     - Alphabetically sorted results
     - No duplicates
============================================================ -->
<script>
const searchBox = document.getElementById("search-box");
const resultSec = document.getElementById("search-results");
const excludedTabs = ["about-section", "tip-section", "contact-section"];

searchBox.addEventListener("input", () => {
    clearDoubleTapSelection();
    const q = searchBox.value.toLowerCase();

    // Clear previous search results
    resultSec.innerHTML = "";

    // If search is empty, hide results
    if (!q) {
        resultSec.classList.remove("active");
        return;
    }

    // DEACTIVATE CURRENT TAB AND TAB BUTTONS
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );
    document.querySelectorAll('.tab-btn').forEach(btn =>
        btn.classList.remove('active')
    );

    const grid = document.createElement("ul");
    grid.className = "icon-grid";
    const foundItems = []; // Store items with their text for sorting

    // Search through all tab sections
    document.querySelectorAll('.tab-content').forEach(sec => {
        if (excludedTabs.includes(sec.id)) return;  // Skip header sections

        sec.querySelectorAll('.icon-wrapper').forEach(icon => {

            // ========================================
            // SEARCHABLE FIELDS
            // ========================================
            
            // 1. TEXT - visible label under icon
            const txt = icon.querySelector('.icon-text')?.textContent.toLowerCase() || "";

            // 2. TOOLTIP - data-tooltip attribute
            const tooltip = (icon.dataset.tooltip || "").toLowerCase();

            // 3. HREF - link URL
            const link = icon.closest('a');
            const href = link ? (link.getAttribute('href') || "").toLowerCase() : "";

            // 4. ALT - image alt text
            const mainImg = icon.querySelector('img:not([class*="icon-badge-pos"])');
            const alt = mainImg ? (mainImg.getAttribute('alt') || "").toLowerCase() : "";

            // 5. TAB - extracted from parent section ID
            const tab = sec.id.toLowerCase();

            // 6. INFO - badge filenames (search badge names)
            const badges = Array.from(icon.querySelectorAll('[class*="icon-badge-pos"]'));
            const info = badges.map(b => {
                const src = b.getAttribute('src') || "";
                // Extract filename without path (e.g., "icon/new.png" → "new.png")
                return src.split('/').pop().replace('.png', '').toLowerCase();
            }).join(' ');

            // ========================================
            // MATCH LOGIC
            // ========================================
            if (
                txt.includes(q) ||
                tooltip.includes(q) ||
                href.includes(q) ||
                alt.includes(q) ||
                tab.includes(q) ||
                info.includes(q)
            ) {
                // Check if already added (by text)
                const alreadyAdded = foundItems.some(item => item.text === txt);
                
                if (!alreadyAdded) {
                    foundItems.push({
                        text: txt,
                        element: icon.closest("li").cloneNode(true)
                    });
                }
            }
        });
    });

    // ========================================
    // SORT ALPHABETICALLY & DISPLAY
    // ========================================
    if (foundItems.length > 0) {
        // Sort by text field
        foundItems.sort((a, b) => a.text.localeCompare(b.text));
        
        // Append sorted elements
        foundItems.forEach(item => {
            grid.appendChild(item.element);
        });

        resultSec.appendChild(grid);
        resultSec.classList.add("active");
    } else {
        resultSec.classList.remove("active");
    }
});
</script>


<!-- ============================================================
     JS SECTION 7 — COPY BUTTON SOUND
============================================================ -->

<script>
document.addEventListener("click", (e) => {
    if (e.target.id === "copy-tip-btn") {
        document.getElementById("copy-sfx").play();
    }
});
</script>


<script>
/* ============================================================
 JS SECTION 8 — MOBILE / DESKTOP MODE TOGGLE (STATE-PRESERVING + FADE)
 - Switches CSS only
 - Preserves active tab + content
 - Waits for CSS + fonts before measuring
============================================================ */

// DOM references from your original code
const mobileToggle = document.getElementById("mobile-toggle");
const mobileCSS    = document.getElementById("mobile-css");
const wrapper      = document.getElementById("page-wrapper");

// ---------------------
// [NEW] readiness utils
// ---------------------
function waitForCss(linkEl) {
  return new Promise((resolve, reject) => {
    if (linkEl.sheet) return resolve();   // already loaded (cache)
    linkEl.addEventListener('load', resolve, { once: true });
    linkEl.addEventListener('error', () => reject(new Error('Failed to load CSS')), { once: true });
  });
}

function waitForFonts() {
  if (document.fonts && document.fonts.ready) {
    return document.fonts.ready.catch(() => {});
  }
  return Promise.resolve();
}

// ---------------------
// State capture/restore
// ---------------------
function captureUIState() {
  return {
    activeTabBtn: document.querySelector(".tab-btn.active"),
    activeHeaderLink: document.querySelector(".header-text-link.active"),
    activeSection: document.querySelector(".tab-content.active")
  };
}


function restoreUIState(state) {
  const hasSomething =
    state.activeTabBtn || state.activeHeaderLink || state.activeSection;

  // Only clear if we actually have a saved state to restore
  if (hasSomething) {
    document.querySelectorAll(".tab-btn, .header-text-link")
      .forEach(el => el.classList.remove("active"));
    document.querySelectorAll(".tab-content")
      .forEach(sec => sec.classList.remove("active"));

    if (state.activeTabBtn) state.activeTabBtn.classList.add("active");
    if (state.activeHeaderLink) state.activeHeaderLink.classList.add("active");
    if (state.activeSection) state.activeSection.classList.add("active");
  }
}


// ---------------------
// [REPLACED] Enablers
// ---------------------
function enableMobileMode(state) {
  mobileCSS.href = "styles/mobile.css";        // begin loading mobile CSS
  mobileToggle.textContent = "desktop";
  localStorage.setItem("ui-mode", "mobile");

  // Flush layout queue
  void document.body.offsetHeight;

  // Wait for stylesheet + fonts (prevents first-paint mis-measure)
  Promise.all([waitForCss(mobileCSS), waitForFonts()]).then(() => {
    // Double rAF to ensure final style/layout commit
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        restoreUIState(state);
        if (typeof positionContent === "function") positionContent();
      });
    });
  });
}

function disableMobileMode(state) {
  mobileCSS.href = "";                         // remove mobile CSS
  mobileToggle.textContent = "mobile";
  localStorage.setItem("ui-mode", "desktop");

  void document.body.offsetHeight;

  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      restoreUIState(state);
      if (typeof positionContent === "function") positionContent();
    });
  });
}

// ---------------------
// Fade transition (keep)
// ---------------------
function swapModeWithFade(enableMobile) {
  wrapper.classList.add("fading");        // fade out
  setTimeout(() => {
    const state = captureUIState();
    if (enableMobile) enableMobileMode(state);
    else              disableMobileMode(state);
    // ==================== NEW ====================
    // Reveal page after mode is applied
    wrapper.style.visibility = "visible"; // NEW
    // ==================== END NEW ====================
  }, 50);
  setTimeout(() => {
    wrapper.classList.remove("fading");   // fade back in
  }, 200);
}

// Toggle handler (keep)
mobileToggle.addEventListener("click", (e) => {
  e.preventDefault();
  e.stopPropagation();                // prevent tab logic
  clearDoubleTapSelection();      // <-- NEW: release armed icon on mode toggle
  mobileToggle.classList.add("blink");
  setTimeout(() => mobileToggle.classList.remove("blink"), 150);
  mobileToggle.classList.remove("active");
  const enableMobile = localStorage.getItem("ui-mode") !== "mobile";
  swapModeWithFade(enableMobile);
});

// Restore mode on page load (keep)
window.addEventListener("load", () => {
  if (localStorage.getItem("ui-mode") === "mobile") {
    const state = captureUIState();
    enableMobileMode(state);
  }
});

// [OPTIONAL] One-time re-measure after fonts become ready
window.addEventListener("load", () => {
  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(() => {
      if (typeof positionContent === "function") positionContent();
    });
  }
});

// [OPTIONAL] Re-measure after BFCache restore (history navigation)
window.addEventListener("pageshow", () => {
  if (typeof positionContent === "function") positionContent();
});
    
// Auto-enable mobile mode on smartphones
(function() {
    const isMobileDevice = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

    // Only enable if no previous choice was stored
    if (isMobileDevice && localStorage.getItem("ui-mode") !== "mobile") {
        const state = captureUIState?.() || {};
        enableMobileMode(state);
    }
})();
    
</script>


<!-- ============================================================
     JS SECTION 9 — DEFERRED FIREFLY BACKGROUND LOADER
     ------------------------------------------------------------
     - Runs AFTER page is fully loaded
     - Uses idle time when possible
     - Zero impact on interactivity
============================================================ -->
<script>
(function () {
    const PARTICLE_COUNT = 33;

    function createFireflies() {
        const fireflyLayer = document.getElementById("firefly-layer");
        if (!fireflyLayer) return;

        for (let i = 0; i < PARTICLE_COUNT; i++) {
            const f = document.createElement("div");
            f.className = "firefly";

            f.style.setProperty("--x", Math.random() * 100);
            f.style.setProperty("--duration", 8 + Math.random() * 10 + "s");
            f.style.setProperty("--fade-duration", 2 + Math.random() * 3 + "s");
            f.style.setProperty("--delay", Math.random() * 10 + "s");
            f.style.setProperty("--firefly-size", 3 + Math.random() * 4 + "px");

            fireflyLayer.appendChild(f);
        }
    }

    function deferFireflies() {
        if ("requestIdleCallback" in window) {
            requestIdleCallback(createFireflies, { timeout: 1500 });
        } else {
            setTimeout(createFireflies, 800);
        }
    }

    // window.addEventListener("load", deferFireflies);  ← Just add // to disable
})();
</script>
    
</div>
</body>
</html>
